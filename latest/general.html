<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>General interface · IndirectLikelihood</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>IndirectLikelihood</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="index.html">Introduction</a></li><li class="current"><a class="toctext" href="general.html">General interface</a><ul class="internal"><li><a class="toctext" href="#Overview-and-concepts-1">Overview and concepts</a></li><li><a class="toctext" href="#data-1">Data</a></li><li><a class="toctext" href="#Structural-models-1">Structural models</a></li><li><a class="toctext" href="#common_random_numbers-1">Common random numbers</a></li><li><a class="toctext" href="#Likelihood-1">Likelihood</a></li><li><a class="toctext" href="#Problem-framework-1">Problem framework</a></li><li><a class="toctext" href="#Utilities-1">Utilities</a></li></ul></li><li><a class="toctext" href="auxiliary.html">Auxiliary models</a></li><li><a class="toctext" href="internals.html">Internals</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href="general.html">General interface</a></li></ul><a class="edit-page" href="https://github.com/tpapp/IndirectLikelihood.jl/blob/master/docs/src/general.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>General interface</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="general_interface-1" href="#general_interface-1">General interface</a></h1><h2><a class="nav-anchor" id="Overview-and-concepts-1" href="#Overview-and-concepts-1">Overview and concepts</a></h2><p>The general interface supports the following setup for likelihood-based indirect inference, using a <strong>structural model</strong> <span>$S$</span> and an <strong>auxiliary model</strong> <span>$A$</span>, with given <strong>data</strong> <span>$y$</span>.</p><p>For each set of <strong>parameters</strong> <span>$θ$</span>, a <strong>structural model</strong> <span>$S$</span> is used to generate <strong>simulated data</strong> <span>$x$</span>, ie</p><div>\[x_S(θ, ϵ)\]</div><p>where <span>$ϵ$</span> is a set of <a href="general.html#common_random_numbers-1">common random numbers</a> that can be kept constant for various <span>$θ$</span>s. Nevertheless, the above is not necessarily a deterministic relationship, as additional randomness can be used.</p><p>An <strong>auxiliary model</strong> <span>$A$</span> with parameters <span>$ϕ$</span> can be estimated using generated data <span>$x$</span> with maximum likelihood, ie</p><div>\[ϕ_A(x) = \arg\max_ϕ p_A(x ∣ ϕ)\]</div><p>is the maximum likelihood estimate.</p><p>The likelihood of <span>$y$</span> at parameters <span>$θ$</span> is obtained as</p><div>\[p_A(y ∣ ϕ_A(x_S(θ, ϵ))\]</div><p>This is multiplied by a prior in <span>$θ$</span>, specified in logs.</p><p>The <strong>user should define</strong></p><ol><li><p><strong>types</strong> for the <em>structural model</em> and the <em>auxiliary model</em>,</p></li><li><p><strong>methods</strong> for the functions below to dispatch on these types.</p></li></ol><table><tr><th>component</th><th>Julia method</th></tr><tr><td><span>$x_M$</span></td><td><a href="general.html#IndirectLikelihood.simulate_data"><code>simulate_data</code></a></td></tr><tr><td><span>$p_A$</span></td><td><a href="general.html#IndirectLikelihood.loglikelihood"><code>loglikelihood</code></a></td></tr><tr><td><span>$ϕ_A$</span></td><td><a href="general.html#IndirectLikelihood.MLE"><code>MLE</code></a></td></tr><tr><td>draw <span>$ϵ$</span></td><td><a href="general.html#IndirectLikelihood.common_random"><code>common_random</code></a></td></tr></table><p>The framework is explained in detail below.</p><h2><a class="nav-anchor" id="data-1" href="#data-1">Data</a></h2><p>Data can be of any type, since it is generated and used by user-defined functions. Arrays, tuples (optionally named) are recommended for simple models, as there no need to wrap them in a type, as the auxiliary model type is used for dispatch.</p><p>More complex data structures may benefit from being wrapped in a <code>struct</code>.</p><h2><a class="nav-anchor" id="Structural-models-1" href="#Structural-models-1">Structural models</a></h2><p>A structural model can be used to generate <a href="general.html#data-1">data</a> from parameters <span>$θ$</span> and random numbers <span>$ϵ$</span> using <a href="general.html#IndirectLikelihood.simulate_data"><code>simulate_data</code></a>. The mapping is not necessarily deterministic even given <span>$ϵ$</span>, but the latter can be used for <a href="general.html#common_random_numbers-1">common random numbers</a> for certain models, to make the mapping continuous, or reduce variance in simulations.</p><p>When applicable, independent variables (eg covariates) necessary for simulation should be included in the structural model object. It is recommended that a type is defined for each problem, along with methods for <a href="general.html#IndirectLikelihood.simulate_data"><code>simulate_data</code></a>.</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IndirectLikelihood.simulate_data" href="#IndirectLikelihood.simulate_data"><code>IndirectLikelihood.simulate_data</code></a> — <span class="docstring-category">Function</span>.</div><div><pre><code class="language-julia">simulate_data(rng, structural_model, θ, ϵ)
</code></pre><p>Simulate data from the <code>structural_model</code></p><ol><li><p>using random number generator <code>rng</code>,</p></li><li><p>with parameters <code>θ</code>,</p></li><li><p>common random numbers <code>ϵ</code>.</p></li></ol><div class="admonition usage"><div class="admonition-title">Usage</div><div class="admonition-text"><p>The user should define a method for this function for each <code>structural_model</code> type with the signature</p><pre><code class="language-julia">simulate_data(rng::AbstractRNG, structural_model, θ, ϵ)</code></pre><p>This should return simulated <code>data</code> in the format that can be used by <a href="general.html#IndirectLikelihood.MLE"><code>MLE</code></a> and <a href="general.html#IndirectLikelihood.loglikelihood"><code>loglikelihood</code></a>.</p><p>For infeasible/meaningless parameters, <code>nothing</code> should be returned.</p></div></div></div><a class="source-link" target="_blank" href="https://github.com/tpapp/IndirectLikelihood.jl/blob/71bd1d831386a36c5ced7b19b8255f517d64a01f/src/general.jl#L13-L36">source</a><div><pre><code class="language-julia">simulate_data(rng, structural_model, θ)
</code></pre><p>Simulate data, generating <code>ϵ</code> using <code>rng</code>.</p><p>See <a href="general.html#IndirectLikelihood.common_random"><code>common_random</code></a>.</p><div class="admonition usage"><div class="admonition-title">Usage</div><div class="admonition-text"><p>For interactive/exploratory use. Models should define methods for <a href="general.html#IndirectLikelihood.simulate_data"><code>simulate_data(rng::AbstractRNG, structural_model, θ, ϵ)</code></a>.</p></div></div></div><a class="source-link" target="_blank" href="https://github.com/tpapp/IndirectLikelihood.jl/blob/71bd1d831386a36c5ced7b19b8255f517d64a01f/src/general.jl#L40-L51">source</a><div><pre><code class="language-julia">simulate_data(structural_model, θ)
</code></pre><p>Simulate data, generating <code>ϵ</code> with the default random number generator.</p><p>See <a href="general.html#IndirectLikelihood.common_random"><code>common_random</code></a>.</p><div class="admonition usage"><div class="admonition-title">Usage</div><div class="admonition-text"><p>For interactive/exploratory use. Models should define methods for <a href="general.html#IndirectLikelihood.simulate_data"><code>simulate_data(rng::AbstractRNG, structural_model, θ, ϵ)</code></a>.</p></div></div></div><a class="source-link" target="_blank" href="https://github.com/tpapp/IndirectLikelihood.jl/blob/71bd1d831386a36c5ced7b19b8255f517d64a01f/src/general.jl#L55-L66">source</a></section><h2><a class="nav-anchor" id="common_random_numbers-1" href="#common_random_numbers-1">Common random numbers</a></h2><p>Common random numbers are a set of random numbers that can be re-used for for simulation with different parameter values.</p><p><a href="general.html#IndirectLikelihood.common_random"><code>common_random</code></a> should yield a random value for the random variables (usually an <code>Array</code> or a collection of similar structures).</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IndirectLikelihood.common_random" href="#IndirectLikelihood.common_random"><code>IndirectLikelihood.common_random</code></a> — <span class="docstring-category">Function</span>.</div><div><pre><code class="language-julia">common_random(rng, structural_model)
</code></pre><p>Return common random numbers that can be reused by <a href="general.html#IndirectLikelihood.simulate_data"><code>simulate_data</code></a> with different parameters.</p><p>When the model structure does not allow common random numbers, return <code>nothing</code>.</p><p>The first argument is the random number generator.</p><div class="admonition usage"><div class="admonition-title">Usage</div><div class="admonition-text"><p>The user should define a method for this function for each <code>structural_model</code> type.</p></div></div><p>See also <a href="general.html#IndirectLikelihood.common_random!"><code>common_random!</code></a> for further optimizations.</p></div><a class="source-link" target="_blank" href="https://github.com/tpapp/IndirectLikelihood.jl/blob/71bd1d831386a36c5ced7b19b8255f517d64a01f/src/general.jl#L69-L85">source</a></section><p>For error structures which can be overwritten in place, the user can define <a href="general.html#IndirectLikelihood.common_random!"><code>common_random!</code></a> as an optimization.</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IndirectLikelihood.common_random!" href="#IndirectLikelihood.common_random!"><code>IndirectLikelihood.common_random!</code></a> — <span class="docstring-category">Function</span>.</div><div><pre><code class="language-julia">common_random!(rng, structural_model, ϵ)
</code></pre><p>Update the common random numbers for the model. The semantics is as follows:</p><ol><li><p>it <em>may</em>, but does not need to, change the contents of its second argument,</p></li><li><p>the new common random numbers should be returned regardless.</p></li></ol><p>Two common usage patterns are</p><ol><li><p>having a mutable <code>ϵ</code>, updating that in place, returning <code>ϵ</code>,</p></li><li><p>generating new <code>ϵ</code>, returning that.</p></li></ol><div class="admonition note"><div class="admonition-title">Note</div><div class="admonition-text"><p>The default method falls back to <a href="general.html#IndirectLikelihood.common_random"><code>common_random</code></a>, reallocating with each call. A method for this function should be defined only when allocations can be optimized.</p></div></div></div><a class="source-link" target="_blank" href="https://github.com/tpapp/IndirectLikelihood.jl/blob/71bd1d831386a36c5ced7b19b8255f517d64a01f/src/general.jl#L89-L109">source</a><div><pre><code class="language-julia">common_random!(rng, problem)
</code></pre><p>Return a new problem with updated common random numbers.</p></div><a class="source-link" target="_blank" href="https://github.com/tpapp/IndirectLikelihood.jl/blob/71bd1d831386a36c5ced7b19b8255f517d64a01f/src/general.jl#L131-L135">source</a></section><h2><a class="nav-anchor" id="Likelihood-1" href="#Likelihood-1">Likelihood</a></h2><p>These methods should be defined for stuctural model types, and accept data from <a href="general.html#IndirectLikelihood.simulate_data"><code>simulate_data</code></a>.</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IndirectLikelihood.MLE" href="#IndirectLikelihood.MLE"><code>IndirectLikelihood.MLE</code></a> — <span class="docstring-category">Function</span>.</div><div><pre><code class="language-julia">MLE(auxiliary_model, data)
</code></pre><p>Maximum likelihood estimate of the parameters for <code>data</code> in <code>model</code>.</p><p>When <code>ϕ == MLE(auxiliary_model, data)</code>, <code>ϕ</code> should maximize</p><pre><code class="language-julia">ϕ -&gt; loglikelihood(auxiliary_model, data, ϕ)</code></pre><p>See <a href="general.html#IndirectLikelihood.loglikelihood"><code>loglikelihood</code></a>.</p><p>Methods should be defined by the user for each <code>auxiliary_model</code> type. A fallback method is defined for <code>nothing</code> as data (infeasible parameters). See also <a href="general.html#IndirectLikelihood.simulate_data"><code>simulate_data</code></a>.</p></div><a class="source-link" target="_blank" href="https://github.com/tpapp/IndirectLikelihood.jl/blob/71bd1d831386a36c5ced7b19b8255f517d64a01f/src/general.jl#L145-L159">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IndirectLikelihood.loglikelihood" href="#IndirectLikelihood.loglikelihood"><code>IndirectLikelihood.loglikelihood</code></a> — <span class="docstring-category">Function</span>.</div><div><pre><code class="language-julia">loglikelihood(auxiliary_model, data, ϕ)
</code></pre><p>Log likelihood of <code>data</code> under <code>auxiliary_model</code> with parameters <span>$ϕ$</span>. See <a href="general.html#IndirectLikelihood.MLE"><code>MLE</code></a>.</p></div><a class="source-link" target="_blank" href="https://github.com/tpapp/IndirectLikelihood.jl/blob/71bd1d831386a36c5ced7b19b8255f517d64a01f/src/general.jl#L164-L168">source</a></section><h2><a class="nav-anchor" id="Problem-framework-1" href="#Problem-framework-1">Problem framework</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IndirectLikelihood.IndirectLikelihoodProblem" href="#IndirectLikelihood.IndirectLikelihoodProblem"><code>IndirectLikelihood.IndirectLikelihoodProblem</code></a> — <span class="docstring-category">Type</span>.</div><div><pre><code class="language-none">IndirectLikelihoodProblem(data, log_prior, structural_model, auxiliary_model, ϵ)</code></pre><p>A simple wrapper for an indirect likelihood problem.</p><p>The user should implement <a href="general.html#IndirectLikelihood.simulate_data"><code>simulate_data</code></a>, <a href="general.html#IndirectLikelihood.MLE"><code>MLE</code></a>, <a href="general.html#IndirectLikelihood.loglikelihood"><code>loglikelihood</code></a>, and <a href="general.html#IndirectLikelihood.common_random"><code>common_random</code></a>.</p></div><a class="source-link" target="_blank" href="https://github.com/tpapp/IndirectLikelihood.jl/blob/71bd1d831386a36c5ced7b19b8255f517d64a01f/src/general.jl#L115-L122">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IndirectLikelihood.simulate_problem" href="#IndirectLikelihood.simulate_problem"><code>IndirectLikelihood.simulate_problem</code></a> — <span class="docstring-category">Function</span>.</div><div><pre><code class="language-none">simulate_problem([rng], log_prior, structural_model, auxiliary_model, θ)</code></pre><p>Initialize an <a href="general.html#IndirectLikelihood.IndirectLikelihoodProblem"><code>IndirectLikelihoodProblem</code></a> with simulated data, using parameters <code>θ</code>.</p><p>Useful for debugging and exploration of identification with simulated data.</p></div><a class="source-link" target="_blank" href="https://github.com/tpapp/IndirectLikelihood.jl/blob/71bd1d831386a36c5ced7b19b8255f517d64a01f/src/general.jl#L214-L221">source</a></section><h2><a class="nav-anchor" id="Utilities-1" href="#Utilities-1">Utilities</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IndirectLikelihood.local_jacobian" href="#IndirectLikelihood.local_jacobian"><code>IndirectLikelihood.local_jacobian</code></a> — <span class="docstring-category">Function</span>.</div><div><pre><code class="language-julia">local_jacobian(problem, θ₀, ω_to_θ; vecϕ)
</code></pre><p>Calculate the local Jacobian of the estimated auxiliary parameters <span>$ϕ$</span> at the structural parameters <span>$θ=θ₀$</span>.</p><p><code>ω_to_θ</code> maps a vector of reals <code>ω</code> to the parameters <code>θ</code> in the format acceptable to <code>structural_model</code>. It should support <a href="@ref"><code>ContinuousTransformations.transform</code></a> and <a href="@ref"><code>ContinuousTransformations.inverse</code></a>. See, for example, <a href="@ref"><code>ContinuousTransformations.TransformationTuple</code></a>.</p><p><code>vecϕ</code> is a function that is used to flatten the auxiliary parameters to a vector. Defaults to <a href="general.html#IndirectLikelihood.vec_parameters"><code>vec_parameters</code></a>.</p></div><a class="source-link" target="_blank" href="https://github.com/tpapp/IndirectLikelihood.jl/blob/71bd1d831386a36c5ced7b19b8255f517d64a01f/src/general.jl#L296-L310">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IndirectLikelihood.vec_parameters" href="#IndirectLikelihood.vec_parameters"><code>IndirectLikelihood.vec_parameters</code></a> — <span class="docstring-category">Function</span>.</div><div><p>Return the values of the argument as a vector, potentially (but not necessarily) restricting to those elements that uniquely determine the argument.</p><p>For example, a symmetric matrix would be determined by the diagonal and either half.</p></div><a class="source-link" target="_blank" href="https://github.com/tpapp/IndirectLikelihood.jl/blob/71bd1d831386a36c5ced7b19b8255f517d64a01f/src/general.jl#L235-L243">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="IndirectLikelihood.indirect_loglikelihood" href="#IndirectLikelihood.indirect_loglikelihood"><code>IndirectLikelihood.indirect_loglikelihood</code></a> — <span class="docstring-category">Function</span>.</div><div><pre><code class="language-none">indirect_loglikelihood(auxiliary_model, y, x)</code></pre><ol><li><p>estimate <code>auxiliary_model</code> from summary statistics <code>x</code> using maximum likelihood,</p></li><li><p>return the likelihood of summary statistics <code>y</code> under the estimated parameters.</p></li></ol><p>Useful for pseudo-likelihood indirect inference, where <code>y</code> would be the observed and <code>x</code> the simulated data.</p></div><a class="source-link" target="_blank" href="https://github.com/tpapp/IndirectLikelihood.jl/blob/71bd1d831386a36c5ced7b19b8255f517d64a01f/src/general.jl#L172-L181">source</a></section><footer><hr/><a class="previous" href="index.html"><span class="direction">Previous</span><span class="title">Introduction</span></a><a class="next" href="auxiliary.html"><span class="direction">Next</span><span class="title">Auxiliary models</span></a></footer></article></body></html>
